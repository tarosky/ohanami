# Ohanami é–‹ç™ºãƒ«ãƒ¼ãƒ«

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯é–‹ç™ºè€…å‘ã‘ã®æŠ€è¡“çš„ãªã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§ã™ã€‚

## ðŸ“‹ Gitã‚³ãƒŸãƒƒãƒˆå‰ã®ç¢ºèªäº‹é …

### 1. Box PHARãƒ“ãƒ«ãƒ‰é–¢é€£
- [ ] **GitHub Actionsã§ã®ä¾å­˜é–¢ä¿‚ç®¡ç†ã‚’æ­£ã—ãè¨­å®š**
  - `composer install --no-dev`ã§ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ä¾å­˜é–¢ä¿‚ã®ã¿ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  - Box PHAR builderã¯ GitHub Releases ã‹ã‚‰ç›´æŽ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆv4.6.8ï¼‰
  - é–‹ç™ºãƒ„ãƒ¼ãƒ«ï¼ˆphpcs, phpstanç­‰ï¼‰ãŒPHARã«å«ã¾ã‚Œãªã„ã“ã¨ã‚’ç¢ºèª

### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] **wp-cliå®Ÿè¡Œæ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…**
  - çµ‚äº†ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ­£ç¢ºãªåˆ¤å®šï¼ˆ`wp core is-installed`ç­‰ï¼‰
  - Fatal Errorã€Parse Errorã€Warningç­‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒžãƒƒãƒãƒ³ã‚°
  - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ï¼ˆ`wp-includes/version.php`ã‹ã‚‰ã®æƒ…å ±å–å¾—ï¼‰

### 3. WordPressæ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
- [ ] **wp-settings.phpãƒ™ãƒ¼ã‚¹æ¤œå‡ºã®ä½¿ç”¨**
  - wp-config.phpã®é…ç½®å•é¡Œã‚’å›žé¿
  - å†å¸°çš„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¤œç´¢ï¼ˆmaxDepthè¨­å®šï¼‰
  - å¤ã„WordPressãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚‚å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

## ðŸ”§ GitHub Actionsæœ€é©åŒ–

### ãƒªãƒªãƒ¼ã‚¹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```yaml
# âŒ æ‚ªã„ä¾‹ï¼š--no-devã‚’å‰Šé™¤ã™ã‚‹ã¨é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚‚å«ã¾ã‚Œã‚‹
composer install --prefer-dist --optimize-autoloader

# âœ… è‰¯ã„ä¾‹ï¼šãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ä¾å­˜é–¢ä¿‚ã®ã¿ + Boxç›´æŽ¥å–å¾—  
composer install --prefer-dist --optimize-autoloader --no-dev
curl -L https://github.com/box-project/box/releases/download/4.6.8/box.phar -o box.phar
```

### å¿…é ˆãƒã‚§ãƒƒã‚¯é …ç›®
- [ ] Box PHARãŒæ­£å¸¸ã«ãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ã“ã¨
- [ ] PHARã‚µã‚¤ã‚ºãŒé©åˆ‡ã§ã‚ã‚‹ã“ã¨ï¼ˆ~46KBï¼‰
- [ ] ãƒã‚§ãƒƒã‚¯ã‚µãƒ ï¼ˆSHA256/MD5ï¼‰ãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨

## ðŸš¨ ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

### 1. Box PHAR builder not found
**ç—‡çŠ¶**: `/vendor/bin/box: No such file or directory`

**åŽŸå› **: `--no-dev`ã§humbug/boxãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è§£æ±º**: GitHub Releasesã‹ã‚‰ç›´æŽ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```bash
curl -L https://github.com/box-project/box/releases/download/4.6.8/box.phar -o box.phar
chmod +x box.phar
php box.phar compile
```

### 2. wp-cli Fatal Error
**ç—‡çŠ¶**: `Fatal error: ...` ãŒå‡ºåŠ›ã•ã‚Œã¦WordPressæƒ…å ±å–å¾—å¤±æ•—

**è§£æ±º**: ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒã¨ç¶™ç¶šå‡¦ç†
```php
// 2>&1ã§stderrã‚‚å–å¾—
exec($fullCommand, $output, $exitCode);

// PHPã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒžãƒƒãƒãƒ³ã‚°  
if ($this->containsPhpError($result)) {
    throw new \Exception("wp-cli PHP error: " . trim($result));
}
```

### 3. WordPressæ¤œå‡ºå¤±æ•—
**ç—‡çŠ¶**: `wp-config.php`ãŒã‚ã‚‹ã®ã«WordPressã¨ã—ã¦èªè­˜ã•ã‚Œãªã„

**è§£æ±º**: `wp-settings.php`ãƒ™ãƒ¼ã‚¹æ¤œå‡ºã«å¤‰æ›´
```php
// wp-settings.phpã®å­˜åœ¨ã§WordPressã‚µã‚¤ãƒˆåˆ¤å®š
if (file_exists($directory . '/wp-settings.php')) {
    $sites[] = $directory;
}
```

## ðŸ“¦ ãƒªãƒªãƒ¼ã‚¹ç®¡ç†

### ã‚»ãƒžãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
- **MAJOR**: Breaking changes (v2.0.0)
- **MINOR**: æ–°æ©Ÿèƒ½è¿½åŠ  (v1.1.0)  
- **PATCH**: ãƒã‚°ä¿®æ­£ (v1.0.1)

### ãƒªãƒªãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹
1. feature/***ãƒ–ãƒ©ãƒ³ãƒã§é–‹ç™º
2. PRãƒžãƒ¼ã‚¸ã§release-drafterãŒãƒ‰ãƒ©ãƒ•ãƒˆç”Ÿæˆ
3. GitHubã®GUIã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³èª¿æ•´ãƒ»å…¬é–‹
4. GitHub Actionsã§è‡ªå‹•ãƒ“ãƒ«ãƒ‰ãƒ»ã‚¢ã‚»ãƒƒãƒˆè¿½åŠ 

### å¿…é ˆãƒ†ã‚¹ãƒˆé …ç›®
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®PHARãƒ“ãƒ«ãƒ‰æˆåŠŸ
- [ ] SSHçµŒç”±ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡ŒæˆåŠŸ  
- [ ] JSONå‡ºåŠ›ã®æ§‹é€ ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å‹•ä½œç¢ºèª

## ðŸ” ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

### Safeç³»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³
ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚å‡¦ç†ç¶™ç¶šã™ã‚‹ãŸã‚ã€å„æ©Ÿèƒ½ã«Safeç³»ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ï¼š

```php
private function collectCoreInfoSafe(string $sitePath): array
{
    try {
        return $this->collectCoreInfo($sitePath);
    } catch (\Exception $e) {
        return [
            'version' => null,
            'error' => $e->getMessage()
        ];
    }
}
```

### ã‚¨ãƒ©ãƒ¼æƒ…å ±è¨˜éŒ²
å•é¡Œè¨ºæ–­ã®ãŸã‚ã€ã‚¨ãƒ©ãƒ¼æƒ…å ±ã¯å¿…ãšè¨˜éŒ²ï¼š

```php
// âŒ æ‚ªã„ä¾‹ï¼šã‚¨ãƒ©ãƒ¼ã‚’éš è”½
return null;

// âœ… è‰¯ã„ä¾‹ï¼šè©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’è¨˜éŒ²
return [
    'path' => $sitePath,
    'errors' => ['wp-cli exit code 1: Access denied for user']
];
